{"ast":null,"code":"import _toConsumableArray from \"/Users/jaylenthomas/Downloads/modot_web/titanv2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"/Users/jaylenthomas/Downloads/modot_web/titanv2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/Users/jaylenthomas/Downloads/modot_web/titanv2/src/views/pages/data-download/WazeJam.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\"; // reactstrap components\n\nimport { Card, CardHeader, Container, Table } from \"reactstrap\";\nimport { Button, TextField } from \"@material-ui/core\";\nimport moment from 'moment';\nimport { firebase } from '../../../auth/FirebaseAuth'; // import DateFnsUtils from '@date-io/date-fns';\n// import {\n// \tMuiPickersUtilsProvider,\n// \tKeyboardTimePicker,\n// \tKeyboardDatePicker,\n// } from '@material-ui/pickers';\n// import ReactDatetime from \"react-datetime\";\n// core components\n\nimport SimpleHeader from \"components/Headers/SimpleHeader.js\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nvar dateArr = new Date().toISOString().split(':', 2);\nvar today = dateArr[0] + \":\" + dateArr[1];\n\nfunction WazeJam(props) {\n  _s();\n\n  var _this = this;\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _React$useState = React.useState(today),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      startDate = _React$useState2[0],\n      setStartDate = _React$useState2[1];\n\n  var _React$useState3 = React.useState(today),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      endDate = _React$useState4[0],\n      setEndDate = _React$useState4[1];\n\n  var _useState3 = useState('WazeJam'),\n      _useState4 = _slicedToArray(_useState3, 2),\n      fileName = _useState4[0],\n      setFileName = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      blogs = _useState6[0],\n      setBlogs = _useState6[1];\n\n  var _useState7 = useState([]),\n      _useState8 = _slicedToArray(_useState7, 2),\n      queryResults = _useState8[0],\n      setQueryResult = _useState8[1];\n\n  var _useState9 = useState(null),\n      _useState10 = _slicedToArray(_useState9, 2),\n      serverResponse = _useState10[0],\n      setServerResponse = _useState10[1];\n\n  var _useState11 = useState(0),\n      _useState12 = _slicedToArray(_useState11, 2),\n      timer = _useState12[0],\n      setTimer = _useState12[1];\n\n  useEffect(function () {\n    var timer = null;\n\n    if (loading) {\n      timer = setInterval(function () {\n        var obj = queryResults[queryResults.length - 1];\n        var diff = Math.round(Math.abs((new Date() - new Date(obj.querySubmitTime)) / 1000));\n        setTimer(diff);\n      }, 1000);\n    }\n\n    return function () {\n      if (queryResults.length) {\n        queryResults[queryResults.length - 1].status = 'completed';\n      }\n\n      clearInterval(timer);\n    };\n  }, [loading]);\n  useEffect(function () {\n    if (timer) {\n      queryResults[queryResults.length - 1].queryResponseTime = timer;\n    }\n  }, [timer]);\n  useEffect(function () {\n    if (serverResponse) {\n      queryResults[queryResults.length - 1].url = serverResponse.result;\n      queryResults[queryResults.length - 1].status = serverResponse.status;\n      setQueryResult(queryResults);\n    }\n  }, [serverResponse]);\n  useEffect(function () {\n    firebase.auth().onAuthStateChanged(function (user) {\n      // console.log(user)\n      var response = firebase.firestore().collection('downloads').doc('transcoreIncidents').collection(user.uid);\n      response.get().then(function (snapshot) {\n        // console.log(snapshot)\n        snapshot.forEach(function (doc) {\n          // console.log(doc.data())\n          setBlogs([].concat(_toConsumableArray(blogs), [doc.data()]));\n        });\n      });\n    }); // console.log(blogs)\n  }, []);\n\n  var onSubmit = function onSubmit() {\n    if (fileName.trim().length === 0) {\n      alert('Please enter file name.');\n      return;\n    }\n\n    setLoading(true);\n    var results = [].concat(_toConsumableArray(queryResults), [{\n      status: 'progress',\n      querySubmitTime: new Date().toISOString(),\n      queryResponseTime: 0,\n      url: ''\n    }]);\n    setQueryResult(results);\n    fetch(\"http://127.0.0.1:8000/transcore/incident/StartDate/\".concat(startDate, \"/EndDate/\").concat(endDate, \"/IncidenTypes/\").concat(incident_types, \"/County/\").concat(counties, \"/FileName/\").concat(fileName), {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        startDate: \"\".concat(startDate, \":00\"),\n        endDate: \"\".concat(endDate, \":00\"),\n        fileName: fileName\n      })\n    }).then(function (res) {\n      return res.json();\n    }).then(function (response) {\n      setLoading(false);\n      setServerResponse({\n        result: response,\n        status: 'completed'\n      }); //    window.open(results);\n    }).catch(function (err) {\n      console.log('error!!!!!!!');\n      console.log(err);\n    });\n  };\n\n  var download = function download(url) {\n    window.open(url);\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(SimpleHeader, {\n      name: \"Form elements\",\n      parentName: \"Forms\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(Container, {\n      className: \"mt--6\",\n      fluid: true,\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        className: \"cus_container\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"heading waze_jam_clr\",\n          children: \"Query WazeJam Database\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"timing\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"dates\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Start Date & Time\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 150,\n              columnNumber: 8\n            }, this), /*#__PURE__*/_jsxDEV(TextField, {\n              id: \"datetime\",\n              type: \"datetime-local\",\n              defaultValue: startDate,\n              InputProps: {\n                disableUnderline: true\n              },\n              onChange: function onChange(e) {\n                setStartDate(e.target.value);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 151,\n              columnNumber: 8\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 149,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"dates\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"End Date & Time\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 162,\n              columnNumber: 8\n            }, this), /*#__PURE__*/_jsxDEV(TextField, {\n              id: \"datetime-local\",\n              type: \"datetime-local\",\n              defaultValue: endDate,\n              InputProps: {\n                disableUnderline: true\n              },\n              onChange: function onChange(e) {\n                setEndDate(e.target.value);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 163,\n              columnNumber: 8\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"file-name\",\n          children: /*#__PURE__*/_jsxDEV(TextField, {\n            id: \"file-name\",\n            label: \"File Name\",\n            type: \"text\",\n            defaultValue: fileName,\n            InputLabelProps: {\n              shrink: true\n            },\n            onChange: function onChange(e) {\n              return setFileName(e.target.value);\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 176,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"button\",\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            className: \"waze_jam_clr\",\n            variant: \"contained\",\n            disabled: loading,\n            onClick: onSubmit,\n            children: \"SUBMIT QUERY\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(Container, {\n      className: \"mt--10\",\n      fluid: true,\n      children: /*#__PURE__*/_jsxDEV(Card, {\n        children: [/*#__PURE__*/_jsxDEV(CardHeader, {\n          className: \"border-0\",\n          children: /*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"mb-0\",\n            children: \"Query Results\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 201,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 19\n        }, this), /*#__PURE__*/_jsxDEV(Table, {\n          className: \"align-items-center table-flush\",\n          responsive: true,\n          children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n            className: \"thead-light\",\n            children: /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"th\", {\n                scope: \"col\",\n                style: {\n                  backgroundColor: '#172b4d',\n                  color: '#fff'\n                },\n                children: \"Status\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 206,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                scope: \"col\",\n                style: {\n                  backgroundColor: '#172b4d',\n                  color: '#fff'\n                },\n                children: \"Downloads and Reports\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 209,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                scope: \"col\",\n                style: {\n                  backgroundColor: '#172b4d',\n                  color: '#fff'\n                },\n                children: \"Query Date\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 212,\n                columnNumber: 25\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 205,\n              columnNumber: 23\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 204,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n            className: \"list\",\n            children: queryResults.length ? queryResults.map(function (result, index) {\n              return /*#__PURE__*/_jsxDEV(\"tr\", {\n                children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"button\",\n                    children: /*#__PURE__*/_jsxDEV(Button, {\n                      className: \"waze_jam_clr\",\n                      variant: \"contained\",\n                      disabled: result.status === 'progress' ? true : false,\n                      onClick: function onClick() {\n                        return download(result.url);\n                      },\n                      children: result.status === 'progress' ? 'Downloading' : 'Download Ready'\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 223,\n                      columnNumber: 11\n                    }, _this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 222,\n                    columnNumber: 10\n                  }, _this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 221,\n                  columnNumber: 9\n                }, _this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  className: \"budget\",\n                  children: [\"Query returned in \", result.queryResponseTime > 60 ? result.queryResponseTime / 60 : result.queryResponseTime, \" seconds\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 236,\n                  columnNumber: 9\n                }, _this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: moment(result.querySubmitTime).format('MMM DD, YYYY hh:mm A')\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 240,\n                  columnNumber: 9\n                }, _this)]\n              }, index, true, {\n                fileName: _jsxFileName,\n                lineNumber: 220,\n                columnNumber: 16\n              }, _this);\n            }) : /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: /*#__PURE__*/_jsxDEV(\"td\", {\n                colSpan: \"3\",\n                style: {\n                  textAlign: 'center',\n                  fontSize: 20\n                },\n                children: \"Data not found.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 250,\n                columnNumber: 9\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 249,\n              columnNumber: 8\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 217,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 19\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 4\n    }, this)]\n  }, void 0, true);\n}\n\n_s(WazeJam, \"QtdZSC+jIfZ5qrvnl7obTHcjJpk=\");\n\n_c = WazeJam;\nexport default WazeJam;\n\nvar _c;\n\n$RefreshReg$(_c, \"WazeJam\");","map":{"version":3,"sources":["/Users/jaylenthomas/Downloads/modot_web/titanv2/src/views/pages/data-download/WazeJam.js"],"names":["React","useState","useEffect","Card","CardHeader","Container","Table","Button","TextField","moment","firebase","SimpleHeader","dateArr","Date","toISOString","split","today","WazeJam","props","loading","setLoading","startDate","setStartDate","endDate","setEndDate","fileName","setFileName","blogs","setBlogs","queryResults","setQueryResult","serverResponse","setServerResponse","timer","setTimer","setInterval","obj","length","diff","Math","round","abs","querySubmitTime","status","clearInterval","queryResponseTime","url","result","auth","onAuthStateChanged","user","response","firestore","collection","doc","uid","get","then","snapshot","forEach","data","onSubmit","trim","alert","results","fetch","incident_types","counties","method","headers","body","JSON","stringify","res","json","catch","err","console","log","download","window","open","disableUnderline","e","target","value","shrink","backgroundColor","color","map","index","format","textAlign","fontSize"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\n// reactstrap components\r\nimport {\r\n\tCard,\r\n  \tCardHeader,\r\n\tContainer,\r\n\tTable\r\n} from \"reactstrap\";\r\n\r\nimport {\r\n\tButton,\r\n\tTextField,\r\n} from \"@material-ui/core\";\r\nimport moment from 'moment';\r\nimport {firebase} from '../../../auth/FirebaseAuth'\r\n\r\n// import DateFnsUtils from '@date-io/date-fns';\r\n\r\n// import {\r\n// \tMuiPickersUtilsProvider,\r\n// \tKeyboardTimePicker,\r\n// \tKeyboardDatePicker,\r\n// } from '@material-ui/pickers';\r\n\r\n// import ReactDatetime from \"react-datetime\";\r\n// core components\r\nimport SimpleHeader from \"components/Headers/SimpleHeader.js\";\r\n\r\nconst dateArr = new Date().toISOString().split(':', 2);\r\nconst today = dateArr[0] + \":\" + dateArr[1];\r\n\r\nfunction WazeJam(props) {\r\n\tconst [loading, setLoading] = useState(false);\r\n\tconst [startDate, setStartDate] = React.useState(today);\r\n\tconst [endDate, setEndDate] = React.useState(today);\r\n\tconst [fileName, setFileName] = useState('WazeJam');\r\n\tconst [blogs,setBlogs]=useState([])\r\n\tconst [queryResults, setQueryResult] = useState([]);\r\n\tconst [serverResponse, setServerResponse] = useState(null);\r\n\tconst [timer, setTimer] = useState(0);\r\n\r\n\tuseEffect(() => {\r\n\t\tlet timer = null;\r\n\t\tif (loading) {\r\n\t\t\ttimer = setInterval(() => {\r\n\t\t\t\tvar obj = queryResults[queryResults.length - 1];\r\n\t\t\t\tconst diff = Math.round(\r\n\t\t\t\t\tMath.abs((new Date() - new Date(obj.querySubmitTime)) / 1000));\r\n\t\t\t\tsetTimer(diff);\r\n\t\t\t}, 1000);\r\n\t\t}\r\n\t\treturn () => {\r\n\t\t\tif (queryResults.length) {\r\n\t\t\t\tqueryResults[queryResults.length - 1].status = 'completed';\r\n\t\t\t}\r\n\t\t\tclearInterval(timer);\r\n\t\t};\r\n\t},[loading]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (timer) {\r\n\t\t\tqueryResults[queryResults.length - 1].queryResponseTime = timer;\r\n\t\t}\r\n\t}, [timer]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (serverResponse) {\r\n\t\t\tqueryResults[queryResults.length - 1].url = serverResponse.result;\r\n\t\t\tqueryResults[queryResults.length - 1].status = serverResponse.status;\r\n\t\t\tsetQueryResult(queryResults);\r\n\t\t}\r\n\t}, [serverResponse]);\r\n\r\n\tuseEffect(() =>{\r\n\t\tfirebase.auth().onAuthStateChanged((user) =>{\r\n\r\n\t\t\t// console.log(user)\r\n\t\t\tconst response=firebase.firestore().collection('downloads').doc('transcoreIncidents').collection(user.uid);\r\n\t\t\tresponse.get().then(snapshot=>{\r\n\t\t\t\t// console.log(snapshot)\r\n\t\t\t\tsnapshot.forEach((doc) =>{\r\n\t\t\t\t\t// console.log(doc.data())\r\n\t\t\t\t\tsetBlogs([...blogs,doc.data()])\r\n\t\t\t\t})\r\n\t\t\t})\r\n\r\n\t\t})\r\n\t\t// console.log(blogs)\r\n\r\n\t},[])\r\n\r\n\r\n\tconst onSubmit = () => {\r\n\t\tif (fileName.trim().length === 0) {\r\n\t\t  alert('Please enter file name.');\r\n\t\t  return;\r\n\t\t}\r\n\t\tsetLoading(true);\r\n\t\tvar results = [...queryResults, {\r\n\t\t\tstatus: 'progress',\r\n\t\t\tquerySubmitTime: new Date().toISOString(),\r\n\t\t\tqueryResponseTime: 0,\r\n\t\t\turl: '',\r\n\t\t}];\r\n\t\tsetQueryResult(results);\r\n\t\tfetch(\r\n\t\t\t`http://127.0.0.1:8000/transcore/incident/StartDate/${startDate}/EndDate/${endDate}/IncidenTypes/${incident_types}/County/${counties}/FileName/${fileName}`, {\r\n\t\t\t  method: 'POST',\r\n\t\t\t  headers: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t  },\r\n\t\t\t  body: JSON.stringify({\r\n\t\t\t\tstartDate: `${startDate}:00`,\r\n\t\t\t\tendDate: `${endDate}:00`,\r\n\t\t\t\tfileName\r\n\t\t\t  })\r\n\t\t  })\r\n\t\t.then(res => {\r\n\t\t  return res.json();\r\n\t\t }).then(response => {\r\n\t\t   setLoading(false);\r\n\t\t   setServerResponse({\r\n\t\t\tresult: response,\r\n\t\t\tstatus: 'completed'\r\n\t\t   });\r\n\t\t//    window.open(results);\r\n\t\t })\r\n\t\t .catch(err => {\r\n\t\t\tconsole.log('error!!!!!!!');\r\n\t\t\tconsole.log(err);\r\n\t\t});\r\n\t}\r\n\r\n\tconst download = url => {\r\n\t\twindow.open(url);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<SimpleHeader name=\"Form elements\" parentName=\"Forms\" />\r\n\r\n\t\t\t<Container className=\"mt--6\" fluid>\r\n\t\t\t\t<form className=\"cus_container\">\r\n\t\t\t\t\t<div className=\"heading waze_jam_clr\">\r\n\t\t\t\t\t\tQuery WazeJam Database\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"timing\">\r\n\r\n\t\t\t\t\t\t<div className=\"dates\">\r\n\t\t\t\t\t\t\t<span>Start Date &amp; Time</span>\r\n\t\t\t\t\t\t\t<TextField\r\n\t\t\t\t\t\t\t\tid=\"datetime\"\r\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\r\n\t\t\t\t\t\t\t\tdefaultValue={startDate}\r\n\t\t\t\t\t\t\t\tInputProps={{ disableUnderline: true }}\r\n\t\t\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\t\t\tsetStartDate(e.target.value);\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"dates\">\r\n\t\t\t\t\t\t\t<span>End Date &amp; Time</span>\r\n\t\t\t\t\t\t\t<TextField\r\n\t\t\t\t\t\t\t\tid=\"datetime-local\"\r\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\r\n\t\t\t\t\t\t\t\tdefaultValue={endDate}\r\n\t\t\t\t\t\t\t\tInputProps={{ disableUnderline: true }}\r\n\t\t\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\t\t\tsetEndDate(e.target.value);\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"file-name\">\r\n\t\t\t\t\t\t<TextField\r\n\t\t\t\t\t\t\tid=\"file-name\"\r\n\t\t\t\t\t\t\tlabel=\"File Name\"\r\n\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\tdefaultValue={fileName}\r\n\t\t\t\t\t\t\tInputLabelProps={{\r\n\t\t\t\t\t\t\t\tshrink: true,\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tonChange={(e) => setFileName(e.target.value)}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"button\">\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\tclassName=\"waze_jam_clr\"\r\n\t\t\t\t\t\t\tvariant=\"contained\"\r\n\t\t\t\t\t\t\tdisabled={loading}\r\n\t\t\t\t\t\t\tonClick={onSubmit}>SUBMIT QUERY</Button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</form>\r\n\t\t\t</Container>\r\n\r\n\t\t\t<Container className=\"mt--10\" fluid>\r\n                <Card>\r\n                  <CardHeader className=\"border-0\">\r\n                    <h3 className=\"mb-0\">Query Results</h3>\r\n                  </CardHeader>\r\n                  <Table className=\"align-items-center table-flush\" responsive>\r\n                    <thead className=\"thead-light\">\r\n                      <tr>\r\n                        <th scope=\"col\" style={{backgroundColor: '#172b4d', color: '#fff'}}>\r\n                          Status\r\n                        </th>\r\n                        <th scope=\"col\" style={{backgroundColor: '#172b4d', color: '#fff'}}>\r\n                          Downloads and Reports\r\n                        </th>\r\n                        <th scope=\"col\" style={{backgroundColor: '#172b4d', color: '#fff'}}>\r\n                          Query Date\r\n                        </th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"list\">\r\n\t\t\t\t\t\t{queryResults.length ? (\r\n\t\t\t\t\t\t\tqueryResults.map((result, index) => {\r\n\t\t\t\t\t\t\t\treturn <tr key={index}>\r\n\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t<div className=\"button\">\r\n\t\t\t\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"waze_jam_clr\"\r\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"contained\"\r\n\t\t\t\t\t\t\t\t\t\t\tdisabled={\r\n\t\t\t\t\t\t\t\t\t\t\t\tresult.status === 'progress' ? true : false\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => download(result.url)}>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tresult.status === 'progress' ? 'Downloading' : 'Download Ready'\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t<td className=\"budget\">\r\n\t\t\t\t\t\t\t\t\tQuery returned in {\r\n\t\t\t\t\t\t\t\t\tresult.queryResponseTime > 60 ? result.queryResponseTime / 60 :  result.queryResponseTime} seconds\r\n\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t{ \r\n\t\t\t\t\t\t\t\t\t\tmoment(result.querySubmitTime).format(\r\n\t\t\t\t\t\t\t\t\t\t\t'MMM DD, YYYY hh:mm A')\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t<td colSpan=\"3\" style={{textAlign: 'center', fontSize: 20}}>\r\n\t\t\t\t\t\t\t\t\tData not found.\r\n\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t)}\r\n                    </tbody>\r\n                  </Table>\r\n                </Card>\r\n\t\t\t</Container>\r\n\t\t</>\r\n\t);\r\n}\r\n\r\nexport default WazeJam;\r\n"]},"metadata":{},"sourceType":"module"}